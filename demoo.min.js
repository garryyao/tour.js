Element.implement({getCoordinatesWithOffset:function(offset){return{top:this.getCoordinates().top-offset,left:this.getCoordinates().left-offset,width:this.getCoordinates().width+(offset*2),height:this.getCoordinates().height+(offset*2)}},destroy:function(){this.fade("out");(function(){this.dispose()}).delay(300,this)},});Window.implement({$log:function(){if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log(arguments.length<=1?arguments[0]:arguments)}}});var DeMoo=new Class({Implements:[Options,Events],options:{offset:5,overlay:true,overlayOpacity:0.5,tipOpacity:0.7,tipPosition:$empty,tipFollows:true,tipDisabled:false,onReposition:function(a,b,c){$log("Repositioned expose.")},onFirst:function(a,b,c){$log("Already at the first slide.")},onLast:function(a,b,c){$log("At the last slide, cannot go any further.")}},initialize:function(presentation,options){this.setOptions(options);this.slicesDir=["north","east","west","south"];this.slices={};this.presentation=presentation;this.current={slide:0};window.addEvent("keydown",function(e){switch(e.code){case 32:this.show();break;case 27:this.hide();break;case 49:break}}.bind(this));window.addEvent("resize",function(e){this.expose()}.bind(this))},create:function(){if(this.options.overlay){var sliceProp={"class":"demoo_slice",styles:{opacity:this.options.overlayOpacity}};for(var i=0;i<this.slicesDir.length;i++){this.slices[this.slicesDir[i]]=new Element("span",sliceProp).inject(document.body)}}this.outline=new Element("span",{"class":"demoo_outline"}).inject(document.body);if(!this.options.tipDisabled){this.current.tip=new Element("span",{"class":"demoo_tip",html:"",styles:{opacity:0}}).inject(this.options.tipFollows?this.outline:document.body)}window.addEvent("keydown",this.navigate.bind(this))},show:function(){this.create();this.expose()},navigate:function(e){if(e.code==37||e.code==39){if(this.current.slide<=0&&e.code==37){this.fireEvent("onFirst",[this,this.outline]);return false}if(this.current.slide>=this.presentation.length-1&&e.code==39){this.fireEvent("onLast",[this,this.outline]);return false}this.expose(e.code)}},hide:function(){for(var i=0;i<this.slicesDir.length;i++){this.slices[this.slicesDir[i]].destroy()}this.outline.destroy();this.current.tip.destroy()},expose:function(key){if(key){this.current.slide=(key==37?this.current.slide-1:this.current.slide+1)}this.current.element=document.body.getElement(this.presentation[this.current.slide].element);this.current.description=this.presentation[this.current.slide].description;this.highlighter(this.current.element);if(this.current.tip){this.current.tip.fade(0)}},tip:function(){if(!$chk(this.current.tip)){return false}this.current.tip.set("html",this.current.description).fade(this.options.tipOpacity);this.current.tip.position($merge({relativeTo:this.outline,position:{x:"center",y:"top"},edge:{x:"center",y:"bottom"},ignoreMargins:true,offset:{x:0,y:-15}},this.options.tipPosition))},highlighter:function(el){var elcoords=el.getCoordinatesWithOffset(this.options.offset);this.collected=[this.slices.north,this.slices.east,this.slices.west,this.slices.south,this.outline];this.fxSlices=new Fx.Elements(this.collected,{onComplete:function(){this.tip();this.fireEvent("onReposition",[this,this.outline]);new Fx.Scroll($(document.body)).toElement($pick(this.current.tip,this.outline))}.bind(this),duration:500,transition:"sine:out"});this.fxSlices.start({"0":{height:elcoords.top,width:window.getSize().x},"1":{height:elcoords.height,width:elcoords.left,top:elcoords.top},"2":{height:elcoords.height,width:window.getSize().x-(elcoords.left+elcoords.width),left:(elcoords.left+elcoords.width),top:elcoords.top},"3":{height:window.getScrollSize().y-(elcoords.top+elcoords.height),width:window.getSize().x,top:(elcoords.top+elcoords.height)},"4":elcoords})}});